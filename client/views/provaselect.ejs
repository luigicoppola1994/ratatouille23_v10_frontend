<!DOCTYPE html>
<html>

<head>
  <title>Popolare Select con AJAX</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="../custom/js/dish.js"></script>





  <style>
    /* CSS per il menù del ristorante */
    /* Stilizza l'elemento div con l'ID menu-container */
    #menu-container {
      max-width: 800px;
      margin: 0 auto;
    }

    /* Stilizza l'elemento h2 per le categorie */
    .category h2 {
      font-style: italic;
      font-weight: bold;
      margin: 20px 0 10px;
    }

    /* Stilizza l'elemento div per i piatti */
    .dish {
      margin-bottom: 30px;
    }

    /* Stilizza l'elemento div per il nome del piatto */
    .dish-name {
      font-weight: bold;
    }

    /* Stilizza l'elemento div per gli ingredienti del piatto */
    .dish-description:before {
      content: "INGREDIENTI: ";
      font-weight: bold;
    }

    /* Stilizza l'elemento div per gli allergeni del piatto */
    .dish-allergens:before {
      content: "ALLERGENI: ";
      font-weight: bold;
    }

    /* Stilizza l'elemento div per il costo del piatto */
    .dish-cost:before {
      content: "COSTO: ";
      font-weight: bold;
    }









    /* fine menu stampa*/
    .contain {
      display: flex;
      flex-direction: row;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
    }

    .card {
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      width: 350px;

    }

    .card-destra {
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1);
      padding: 16px;
      margin-left: 10px;
      margin-right: 10px;
      flex-basis: 70%;
    }

    #select-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .select-wrapper {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      flex-wrap: wrap;
      /* Aggiungi questa riga */

    }

    .select-number {
      font-size: 18px;
      font-weight: bold;
      margin-right: 10px;
      color: #555;
    }

    select {
      padding: 5px;
      font-size: 16px;
      border: none;
      background-color: #f2f2f2;
      border-radius: 3px;
      margin-right: 10px;
    }

    button {
      padding: 5px 10px;
      background-color: #43aca0;
      color: #fff;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #8bbbb5;

    }

    /*   menu generatore          */



    h1 {
      text-align: center;
      margin-top: 20px;
      font-size: 3em;
      font-weight: normal;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #43aca0;
    }

    #menu {
      max-width: 800px;
      margin: 20px auto;
      padding: 0;
      border-top: 1px solid #dcdcdc;
      border-bottom: 1px solid #dcdcdc;
      box-shadow: 0px 1px 10px rgba(0, 0, 0, 0.2);
      background-color: #fff;
    }

    .category {
      padding: 20px;
      border-top: 1px solid #dcdcdc;
      border-bottom: 1px solid #dcdcdc;
    }

    .category:first-child {
      border-top: none;
    }

    .category:last-child {
      border-bottom: none;
    }

    .category-title {
      margin: 0;
      padding: 0;
      font-size: 1.5em;
      font-weight: bold;
      text-transform: uppercase;
      color: #8b0000;
    }

    .dish {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      border-bottom: 1px solid #dcdcdc;
      font-size: 1.1em;
      color: #333;
    }

    .dish:last-child {
      border-bottom: none;
    }

    .dish-name {
      margin: 0;
      padding: 0;
    }

    .dish-cost {
      margin: 0;
      padding: 0;
      font-weight: bold;
      color: #43aca0;
    }


    /*  MENU        */
    .list-group {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    .list-group-item {
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }

    .list-group-item:last-child {
      border-bottom: none;
    }


    .contain {
      display: flex;
      flex-direction: row;
    }
  </style>


</head>

<body onload="printMenu(),riempiSelect()">


  <div class="contain">
    <!-- CREO LA CARD DI SINISTRA-->
    <div class="card">
      <button class="btn" id="add-select-btn">Aggiungi categoria</button>
      <button class="btn" id="generaMenu" onclick="generaMenu()">Genera menu</button>
      <button onclick="creaJSONdish()">CREA</button>




      <div class="card" id="select-container"></div>

    </div>


    <div class="card-destra">
      <div class="card-body p-3">
        <div class="card-body pt-4 p-3">
          <h1>Menu Ristorante</h1>
          <ul class="list-group"></ul>
        </div>
      </div>
    </div>
  </div>
  <!-- CREO LA CARD DI SINISTRA-->
  <!--  PORTATA PRODOTTO -->


  <!-- MENU GENERATOR-->


  </div>







  <script>
    function generateListCategorie() {


      $.ajax({
        // todo: sbagliato, devi chiamare il tuo server e internamente il tuo server contatta il backend
        url: 'http://localhost:3000/api/category/all',
        type: 'GET', //send it through get method
        dataType: "json",



        success: function (data, textStatus, xhr) {

          const obj = JSON.parse(xhr.responseText);
          var categories = JSON.stringify(obj.data)
          var categorie = JSON.parse(categories)


          console.log(categorie);

          buildSelect(categorie)






        },
        error: function (xhr, status, error) {
          alert("Auth ko")
          console.log(xhr.responseText);

        }
      });



    }




  </script>




  <script>
    function riempiSelect(){
    const selectContainer = document.getElementById('select-container');
    const addSelectBtn = document.getElementById('add-select-btn');

    let position = 0;

    function addSelect() 
    {
      const selectWrapper = document.createElement('div');
      selectWrapper.classList.add('select-wrapper');

      const selectNumber = document.createElement('span');
      selectNumber.classList.add('select-number');
      selectNumber.textContent = document.querySelectorAll('.select-wrapper').length + 1;

      const select = document.createElement('select');
      select.setAttribute('name', 'categoria');


      $.ajax({
        // todo: sbagliato, devi chiamare il tuo server e internamente il tuo server contatta il backend
        url: 'http://localhost:3000/api/category/all',
        type: 'GET', //send it through get method
        dataType: "json",



        success: function (data, textStatus, xhr) {

          const obj = JSON.parse(xhr.responseText);
          var categories = JSON.stringify(obj.data)
          var categorie = JSON.parse(categories)


          console.log(categorie);

          categorie.forEach((categoria) => {
            const option = document.createElement('option');
            option.setAttribute('value', categoria.id);
            option.textContent = categoria.name;
            select.appendChild(option);
          });

          const deleteBtn = document.createElement('button');
          deleteBtn.textContent = 'Elimina';
          deleteBtn.addEventListener('click', () => {
            selectWrapper.remove();
            // Aggiorno il numero della posizione di tutte le select rimanenti
            const selectWrappers = document.querySelectorAll('.select-wrapper');
            selectWrappers.forEach((wrapper, index) => {
              const selectNumber = wrapper.querySelector('.select-number');
              selectNumber.textContent = index + 1;
            });
          });

          selectWrapper.appendChild(selectNumber);
          selectWrapper.appendChild(select);
          selectWrapper.appendChild(deleteBtn);

          selectContainer.appendChild(selectWrapper);



          addSelectBtn.addEventListener('click', addSelect);







        },
        error: function (xhr, status, error) {
          alert("Auth ko")
          console.log(xhr.responseText);

        }
      });






    }
    addSelectBtn.addEventListener('click', addSelect);

  }


  </script>






  <script>
    function generaMenu() {
      const selectWrappers = document.querySelectorAll('.select-wrapper');

      selectWrappers.forEach((wrapper) => {
        const select = wrapper.querySelector('select');
        const id = select.value;
        const priority = wrapper.querySelector('.select-number').textContent;

        alert("Categoria " + id + "Priorità " + priority)
        var pos = priority


        $.ajax({
          // todo: sbagliato, devi chiamare il tuo server e internamente il tuo server contatta il backend
          url: '/api/category/priority/add/' + id,
          type: 'POST', //send it through get method
          dataType: "json",

          data: {
            priority: pos

          },
          success: function (data, textStatus, xhr) {


            alert("PRIORITA' AGGIUNTA")

            const token = data
            if (token) {
              sessionStorage.setItem("jwt", token);
              //  window.location.replace("dashboard");
              //addListOp(email,password,name,surname,role)

            }
          },
          error: function (xhr, status, error) {
            alert("Auth ko")
            console.log(xhr.responseText);

          }
        });



      });
    }

  </script>









  <!-- MENU GENERATOR

  <script>
    const dishes = [
      {
        "id": 113,
        "name": "Pizza",
        "description": "Cera, pomodoro",
        "cost": 10.6,
        "menuId": 109,
        "categoryId": 55
      },
      {
        "id": 175,
        "name": "Vi Bites Chocolate Monkey",
        "description": "Cia, faf",
        "cost": 10.0,
        "menuId": 109,
        "categoryId": 55
      },
      {
        "id": 211,
        "name": "Burger",
        "description": "Beef, cheese, lettuce, tomato",
        "cost": 12.5,
        "menuId": 109,
        "categoryId": 56
      },
      {
        "id": 275,
        "name": "Caesar Salad",
        "description": "Romaine lettuce, croutons, parmesan cheese, Caesar dressing",
        "cost": 8.0,
        "menuId": 109,
        "categoryId": 57
      }
    ];


    const categories = Array.from(new Set(dishes.map(dish => dish.categoryId)));

    const menuElement = document.getElementById('menu');

    categories.forEach(categoryId => {
      const categoryDishes = dishes.filter(dish => dish.categoryId === categoryId);
      const categoryTitle = `Category ${categoryId}`;
      const categoryElement = document.createElement('li');
      const categoryHeaderElement = document.createElement('h2');
      categoryHeaderElement.textContent = categoryTitle;
      categoryElement.appendChild(categoryHeaderElement);
      const dishListElement = document.createElement('ul');
      categoryDishes.forEach(dish => {
        const dishListElement = document.createElement('ul');
        categoryDishes.forEach(dish => {
          const dishElement = document.createElement('li');
          dishElement.innerHTML = `<strong>${dish.name}</strong> - ${dish.description} - $${dish.cost}`;
          dishListElement.appendChild(dishElement);
        });
        categoryElement.appendChild(dishListElement);

      });
      categoryElement.appendChild(dishListElement);
      menuElement.appendChild(categoryElement);
    });
  </script>
-->


  <script>
    

  </script>





















</body>

</html>