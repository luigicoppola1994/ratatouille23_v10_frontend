<!DOCTYPE html>
<html>

<head>



  <title>Autocompletamento prodotto OpenFoodFacts</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="../custom/js/globals.js"></script>
  <script src="../custom/js/dish.js"></script>

  <style>
    .card {
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1);
      padding: 16px;
      width: 400px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 10px;
      margin-top: 20px;

    }

    /* Stile dell'input di testo */
    .tag-input input[type="text"] {
      border: none;
      padding: 10px;
      font-size: 16px;
      width: 100%;
      outline: none;
    }

    /* Stile del contenitore dell'input tags */
    .tag-input-container {
      margin-top: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
    }

    /* Stile del contenitore dei tag */
    .tags-container {
      display: flex;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    /* Stile di ogni tag */
    .tag {
      background-color: #43aca0;
      color: #fff;
      font-size: 14px;
      padding: 5px 10px;
      border-radius: 3px;
      margin-right: 5px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
    }

    /* Stile dell'icona di cancellazione del tag */
    .tag .tag-close {
      margin-left: 5px;
      cursor: pointer;
    }

    /* Stile del placeholder dell'input di testo */
    .tag-input input[type="text"]::placeholder {
      color: #999;
    }



    /* allergeni */
    body {
      font-family: Arial, sans-serif;
      background-color: #43aca0;
    }

    table {
      border-collapse: collapse;
      margin: 20px 0;
      background-color: #43aca0;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
    }

    th,
    td {
      padding: 10px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }

    input[type=checkbox] {
      margin: 0;
      vertical-align: middle;
    }

    button {
      padding: 10px;
      border: none;
      border-radius: 4px;
      background-color: #43aca0;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #43aca0;
    }



    /* Categoria*/

    /* Stile dell'etichetta del campo di input */
    .input-container label {
      font-family: Arial, sans-serif;
      font-size: 16px;
      margin-right: 10px;
    }

    /* Stile del campo di input */
    .input-container input[type="text"] {
      font-family: Arial, sans-serif;
      font-size: 16px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      flex-grow: 1;
      margin-right: 10px;
    }

    #buttonAddCtg {
      border-color: #f2f2f2;
    }






    .select-container {
      display: flex;
      align-items: center;
    }

    #my-select {
      margin-right: 10px;
    }

    #add-button {
      background-color: #43aca0;
      color: white;
      border: none;
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
    }






    h2 {
      margin-top: 0;
    }

    select {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      margin-bottom: 16px;
      font-size: 16px;
    }

    .input-container {
      display: flex;
      align-items: center;
    }

    label {
      margin-right: 8px;
      font-size: 16px;
    }


    button {
      background-color: #43aca0;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #43aca0;
    }




    /* GESTISCE L'INPUT PORTATA*/
    #search {
      box-sizing: border-box;
      width: 100%;
      height: 40px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
      font-family: Arial, sans-serif;
      background-color: #fff;
      color: #333;
      outline: none;
    }

    #product-list {
      position: absolute;
      list-style-type: none;
      margin: 0;
      padding: 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #fff;
      z-index: 1;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
    }

    #product-list li {
      padding: 10px;
      cursor: pointer;
    }

    #product-list li:hover {
      background-color: #f2f2f2;
    }

    ul#product-list {
      max-width: 100%;
      /* l'elemento pu√≤ espandersi fino alla larghezza massima disponibile */
      width: inherit;
    }
  </style>

  </style>

</head>

<body class="g-sidenav-show   " style="background-color: #afdadc"
  onload=" change(), generateListAllergens(),generateListCategorie()">








  <div class="min-height-300 position-absolute w-100" style="background-color: #43aca0"></div>




  <div class="card">

    <!--  PORTATA PRODOTTO -->
    <label for="search">Nome Portata:</label>
    <input type="text" id="search" name="search" autocomplete="off">

    <ul id="product-list"></ul>





    <!--  INGREDIENTI -->
    <label>Descrizione:</label>
    <div class="tag-input-container">
      <div class="tag-input">
        <input type="text" id="tag-input" placeholder="Clicca ENTER per aggiungere l'ingrediente.">
        <input type="hidden" id="descrizione" name="descrizione">
      </div>
      <div class="tags-container"></div>
    </div>










    <!--ALLERGENI -->

    <section>

      <details>
        <summary>
          Vuoi aggiungere allergeni?
        </summary>
        <p>
        <table id="checkbox-table">
          <thead>

          </thead>
          <tbody></tbody>
        </table>
        </p>
      </details>

    </section>




    <section>
      <!-- CATEGORIE-->
      <details>
        <summary>
          Vuoi assegnare una categoria?
        </summary>
        <p>

          <select id="select_elementi"></select>
        <div class="input-container">
          <input type="text" placeholder="Categoria Personalizzata..." id="input_nuovo_elemento">
          <button type="buttonAddCtg" id="btn_aggiungiCtg">Aggiungi</button>
        </div>
        </p>
      </details>

    </section>


    <p> <label>Prezzo (euro):</label>
      <input type="text" id="price"></input>
    </p>

    <button id="add_portata" onclick="addPortata()"> Crea Portata </button>









    <style>
      section {
        max-width: 450px;
        margin-top: 20px;
        margin-bottom: 15px;

      }

      details {
        background: #43aca0;
        color: white;
        padding: 15px;
        margin-bottom: 2px;
        border-radius: 25px;
      }

      summary {
        cursor: pointer;
        font-weight: 900;
        font-size: 1.2em;
      }


      costo {
        background: #43aca0;
        color: white;
        padding: 15px;
        margin-bottom: 2px;
        border-radius: 25px;
      }

      boxcosto {
        font-weight: 900;
        font-size: 1.2em;
      }
    </style>

























  </div>




  <script>
    const tagInput = document.querySelector('#tag-input');
    const tagsContainer = document.querySelector('.tags-container');
    const descrizioneInput = document.querySelector('#descrizione');

    let tags = [];

    tagInput.addEventListener('keydown', (event) => {
      if (event.key === 'Enter') {
        event.preventDefault();
        const tag = tagInput.value.trim();
        if (tag !== '') {
          tags.push(tag);
          tagInput.value = '';
          renderTags();
        }
      }
    });

    function renderTags() {
      tagsContainer.innerHTML = '';
      tags.forEach((tag, index) => {
        const tagElement = document.createElement('div');
        tagElement.classList.add('tag');
        tagElement.innerHTML = `
      <span class="tag-name">${tag}</span>
      <span class="tag-remove" data-index="${index}">&times;</span>
    `;
        tagElement.querySelector('.tag-remove').addEventListener('click', (event) => {
          const index = parseInt(event.target.getAttribute('data-index'));
          tags.splice(index, 1);
          renderTags();
        });
        tagsContainer.appendChild(tagElement);
      });
      descrizioneInput.value = tags.join(', ');
    }

  </script>




  <script>
    const searchInput = document.querySelector('#search');
    const productList = document.querySelector('#product-list');


    searchInput.addEventListener('input', async (event) => {
      const searchTerm = event.target.value;
      if (searchTerm.length < 2) {
        productList.innerHTML = '';
        return;
      }

      const response = await fetch(`https://it.openfoodfacts.org/cgi/search.pl?search_terms=${searchTerm}&search_simple=1&action=process&json=1&fields=product_name_it`);
      const data = await response.json();
      const products = data.products.filter(product => {
        const productName = product.product_name_it;
        return productName && (productName.toLowerCase() === searchTerm.toLowerCase() || productName.toLowerCase().startsWith(`${searchTerm.toLowerCase()} `));
      });

      productList.innerHTML = '';
      products.forEach(product => {
        const li = document.createElement('li');
        li.textContent = product.product_name_it;
        li.addEventListener('click', () => {
          searchInput.value = product.product_name_it;
          productList.innerHTML = '';
        });
        productList.appendChild(li);
      });
    });

    // Nasconde la lista dei prodotti quando si clicca fuori dall'input
    document.addEventListener('click', (event) => {
      if (event.target !== searchInput && event.target !== productList) {
        productList.innerHTML = '';
      }
    });
  </script>



</body>

</html>